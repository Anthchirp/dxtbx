replay of #156 with added fix
